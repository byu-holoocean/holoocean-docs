<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/><meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Fossen-Based Dynamics — HoloOcean 2.0.1 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/themes_override.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/favicon.png" rel="shortcut icon"/>
<!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/js/theme.js"></script>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../agents/hovering-auv-agent.html" rel="next" title="HoveringAUV"/>
<link href="control-schemes.html" rel="prev" title="Control Schemes"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../../index.html">
            HoloOcean
          </a>
<div class="version"><a href="../../../versionList.html" style="color: inherit;">Develop</a></div>
<div role="search">
<form action="../../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption" role="heading"><span class="caption-text">HoloOcean Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html">Using HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/packages.html">HoloOcean Packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../agents.html">HoloOcean Agents</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../agents.html#using-agents">Using Agents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="agent-config.html">Agent Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="control-schemes.html">Control Schemes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fossen-Based Dynamics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fossen-vehicle-classes">Fossen Vehicle Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#importing-models-from-pythonvehiclesimulator">Importing Models from PythonVehicleSimulator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-agent-fossen-dynamics-example">Single Agent Fossen Dynamics Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-agent-fossen-dynamics-example">Multi Agent Fossen Dynamics Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../agents.html#agent-pages">HoloOcean Agents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sensors/sensors.html">HoloOcean Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versionList.html">Other Versions Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sensors/sensors.html">HoloOcean Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../develop/develop.html">Developing HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/index.html">HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/spaces.html">Action Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/holooceanclient.html">HoloOcean Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/packagemanager.html">Package Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/lcm.html">LCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/dynamics.html">Fossen Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/shmem.html">Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/util.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/weather.html">Weather Controller</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../../index.html">HoloOcean</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Home" class="icon icon-home" href="../../index.html"></a></li>
<li class="breadcrumb-item"><a href="../agents.html">HoloOcean Agents</a></li>
<li class="breadcrumb-item active">Fossen-Based Dynamics</li>
<li class="wy-breadcrumbs-aside">
<a href="../../_sources/agents/docs/fossen-based-dynamics.rst.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<section id="fossen-based-dynamics">
<span id="fossen-dynamics"></span><h1>Fossen-Based Dynamics<a class="headerlink" href="#fossen-based-dynamics" title="Permalink to this heading"></a></h1>
<p>Dynamics for underwater and surface vehicles can be modeled using equations of motion derived in
Thor Fossen’s <em>Handbook of Marine Craft Hydrodynamics and Motion Control</em>. Implementations of these
dynamics are conveniently provided by Fossen at his
<a class="reference external" href="https://github.com/cybergalactic/PythonVehicleSimulator">GitHub repository</a>. We have ported some
of Fossen’s implementations into HoloOcean to enable accurate vehicle dynamics simulations.</p>
<p>Using Fossen-based dynamics in HoloOcean is an extension of the Custom Dynamics control scheme. To use the
built-in Fossen dynamics, there are just a few steps to configure these improved underwater vehicle dynamics.
Here is a summary of the steps to set up Fossen dynamics in HoloOcean with
a more detailed explanation and examples in the next sections:</p>
<ol class="arabic simple">
<li><p>In the scenario configuration, in the agent dictionary, set the ‘fossen_model’ key to the matching
Fossen dynamics class. The available Fossen dynamics classes are listed in the <cite>Fossen Vehicle Classes</cite> section below.</p></li>
<li><p>In the agent dictionary, set the <cite>control_scheme</cite> key to the value for custom dynamics for the agent (see <a class="reference internal" href="control-schemes.html#control-schemes"><span class="std std-ref">Control Schemes</span></a>)</p></li>
<li><p>Setup a Dynamics Sensor in the agent’s sensors list. This sensor is required to read the vehicle state and
apply the dynamics model.</p></li>
<li><p>Optionally, you can set the <cite>dynamics</cite>, <cite>actuator</cite>, and <cite>autopilot</cite> parameters in the agent
configuration. These parameters define the vehicle’s dynamics, control surfaces, and autopilot
settings. This is only supported for Fossen dynamic models with a defined configure_from_scenario function defined.</p></li>
<li><p>Finally, create a FossenInterface manager object in your simulation script, passing the list of agent names and the scenario configuration.
This class is implemented in <cite>client/src/fossen_dynamics/fossen_interface.py</cite>.</p></li>
</ol>
<section id="fossen-vehicle-classes">
<h2>Fossen Vehicle Classes<a class="headerlink" href="#fossen-vehicle-classes" title="Permalink to this heading"></a></h2>
<p>Currently, we have implemented the dynamics models for two vehicle classes:</p>
<p>There is a list of keys that are connected to the Fossen dynamics models. This is defined in the <code class="docutils literal notranslate"><span class="pre">FossenInterface</span></code> class.</p>
<ul>
<li><dl>
<dt>Torpedo (<code class="docutils literal notranslate"><span class="pre">Torpedo:</span> <span class="pre">"torpedo"</span></code>)</dt><dd><p>This class implements the dynamics equations for a torpedo-like vehicle, including the necessary parameters and methods to
calculate accelerations based on control inputs to fins and a single propellor.
Default Fossen vehicle parameters are currently tuned to approximate the REMUS100 vehicle, as described by Thor Fossen.</p>
<dl class="simple">
<dt>Control Modes:</dt><dd><ul class="simple">
<li><p>manualControl: Manually set the commanded control surfaces (fins and propellor)</p></li>
<li><p>depthHeadingAutopilot: Set the depth, heading, and propellor RPM goals which will be handled by the controller</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl>
<dt>Otter (<code class="docutils literal notranslate"><span class="pre">Otter:</span> <span class="pre">"otter"</span></code>)</dt><dd><p>This class implements the dynamic equations for a surface vessel with two propellors at back of the ship. The vehicle does not
support to configure the parameters yet from the scenario.
Default vehicle parameters match the Otter surface vessel.</p>
<dl class="simple">
<dt>Control Modes:</dt><dd><ul class="simple">
<li><p>manualControl: Manually set the commanded control surfaces (propellors)</p></li>
<li><p>headingAutopilot: Not verfied yet by HoloOcean developers. Likely works but with the NED reference frame instead of NWU.</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Unreal Engine graphics asset is not linked to the fossen model.
The number of fins shown on the vehicle will not change in Unreal Engine when changing between
child classes.</p>
<p>Implementing Fossen dynamics does not change the asset, so the fins will not visibly move when
the simulation is running.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mass and other default vehicle parameters set in the HoloOcean engine are ignored when using
the “Custom Dynamics” control scheme. The Fossen models account for these separately.</p>
</div>
</section>
<section id="importing-models-from-pythonvehiclesimulator">
<h2>Importing Models from PythonVehicleSimulator<a class="headerlink" href="#importing-models-from-pythonvehiclesimulator" title="Permalink to this heading"></a></h2>
<p>If a user has developed a dynamics model class using Thor Fossen’s PythonVehicleSimulator and would
like to use it in HoloOcean, they must make the following changes:</p>
<ul>
<li><p>Move the fossen model file into the <cite>client/src/holoocean/fossen_dynamics</cite> folder</p></li>
<li><p>In the fossen model file:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Change the following import statements:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">python_vehicle_simulator.lib</span></code> to <code class="docutils literal notranslate"><span class="pre">holoocean.fossen_dynamics</span></code>
<code class="docutils literal notranslate"><span class="pre">python_vehicle_simulator.lib.gnc</span></code> to <code class="docutils literal notranslate"><span class="pre">holoocean.fossen_dynamics.helper_functions</span></code></p>
</dd>
</dl>
</li>
<li><p>The <cite>dynamics</cite> method must be changed to return nu_dot (body frame accelerations) instead of nu (body frame velocities).</p></li>
<li><p>Add a class variable <code class="docutils literal notranslate"><span class="pre">config_fnc</span></code> that is either set to <code class="docutils literal notranslate"><span class="pre">None</span></code> or a function that takes a scenario configuration</p></li>
</ul>
<p>and modifies the class parameters based on the scenario configuration. See the <cite>client/src/holoocean/fossen_dynamics/torpedo.py</cite>
<code class="docutils literal notranslate"><span class="pre">configure_torpedo_from_scenario</span></code> function for an example of how to implement this function.</p>
</div></blockquote>
</li>
<li><p>In the <cite>client/src/holoocean/fossen_dynamics/fossen_interface.py</cite> file:</p>
<blockquote>
<div><ul class="simple">
<li><p>Add an import statement to import the fossen model class</p></li>
<li><p>Add the class to the fossen model key pairs</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Be sure that all other methods and attributes are implemented as expected by the FossenInterface
manager.</p>
</section>
<section id="single-agent-fossen-dynamics-example">
<h2>Single Agent Fossen Dynamics Example<a class="headerlink" href="#single-agent-fossen-dynamics-example" title="Permalink to this heading"></a></h2>
<p>In this section we will step through the key elements of our Fossen dynamics implementation and give
an example of using Fossen dynamics in HoloOcean. The full code can be found in <cite>client/example.py</cite>.</p>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>Setting up a HoloOcean simulation that uses Fossen dynamics begins with the scenario configuration.
The scenario configuration follows the standard HoloOcean format, with a few key differences for Fossen dynamics:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Dynamics Sensor:</dt><dd><p>When configuring the main agent, you must include the DynamicsSensor in the list of sensors.
The configuration block should include <cite>UseRPY: False</cite> (default is True; this forces the
dynamics to use quaternions instead of Euler angles) and <cite>UseCOM: True</cite> (default is True).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fossen Model:</dt><dd><p>The <cite>fossen_model</cite> key must be set to the name of the Fossen dynamics class you want to use.
For example, for the Torpedo dynamics, set <cite>fossen_model: “torpedo”</cite>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Control Scheme:</dt><dd><p>The <cite>control_scheme</cite> key must be set to value for Custom Dynamics to enable the Fossen dynamics model.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Control Mode (optional):</dt><dd><p>The <cite>control_mode</cite> key can be set to the desired control mode for the vehicle.
For example, you can set it to <cite>depthHeadingAutopilot</cite> for a depth and heading autopilot or
<cite>manualControl</cite> for manual control of the fins and propellor.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Parameters (optional):</dt><dd><p>The parameters <cite>dynamics</cite>, <cite>actuator</cite>, and <cite>autopilot</cite> can be added to the agent
configuration if the configuration function is implemented.
Each of these is a dictionary that overwrites the default vehicle parameters.
The definitions of each dynamics parameters for supported vehicles is defined in the function.</p>
</dd>
</dl>
</li>
</ul>
<p>Below is an example torpedo vehicle scenario configuration that defines all the parameters (matching the default values for the torpedo)
for the Torpedo class. A full description of each parameter can be found in the API documentation for the
Fossen dynamics classes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"torpedo_dynamics"</span><span class="p">,</span>
    <span class="s2">"package_name"</span><span class="p">:</span> <span class="s2">"Ocean"</span><span class="p">,</span>
    <span class="s2">"world"</span><span class="p">:</span> <span class="s2">"OpenWater"</span><span class="p">,</span>
    <span class="s2">"main_agent"</span><span class="p">:</span> <span class="s1">'auv0'</span><span class="p">,</span>
    <span class="s2">"agents"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"agent_name"</span><span class="p">:</span> <span class="s1">'auv0'</span><span class="p">,</span>
            <span class="s2">"agent_type"</span><span class="p">:</span> <span class="s2">"CougUV"</span><span class="p">,</span>
            <span class="s2">"sensors"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"sensor_type"</span><span class="p">:</span> <span class="s2">"DynamicsSensor"</span><span class="p">,</span>
                    <span class="s2">"configuration"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"UseCOM"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">"UseRPY"</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># Use quaternion for dynamics</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">"control_scheme"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Control scheme 1 is how custom dynamics are applied to CougUV agents</span>
            <span class="s2">"location"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">280</span><span class="p">],</span>
            <span class="s2">"rotation"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">"fossen_model"</span><span class="p">:</span> <span class="s2">"torpedo"</span><span class="p">,</span>  <span class="c1"># Fossen dynamics model class to use</span>
            <span class="s2">"control_mode"</span><span class="p">:</span> <span class="s2">"depthHeadingAutopilot"</span><span class="p">,</span>  <span class="c1"># Initial control mode</span>
            <span class="s2">"dynamics"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"rho"</span><span class="p">:</span>          <span class="mi">1026</span><span class="p">,</span>   <span class="c1"># Density of water in kg/m^3</span>
                <span class="c1"># Vehicle physical parameters:</span>
                <span class="s2">"mass"</span><span class="p">:</span>         <span class="mf">31.03</span><span class="p">,</span>     <span class="c1"># Mass of vehicle in kg</span>
                <span class="s2">"length"</span><span class="p">:</span>       <span class="mf">1.6</span><span class="p">,</span>    <span class="c1"># Length of vehicle in m</span>
                <span class="s2">"diam"</span><span class="p">:</span>         <span class="mf">0.19</span><span class="p">,</span>   <span class="c1"># Diameter of vehicle in m</span>
                <span class="s2">"r_bg"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span>   <span class="c1"># Center of gravity of the vehicle (x, y, z) in body frame x forward, y right, z down</span>
                <span class="s2">"r_bb"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="c1"># Center of boyancy of the vehicle (x, y, z) in body frame x forward, y right, z down</span>
                <span class="s2">"area_fraction"</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>   <span class="c1"># relates vehicle effective area to length and width. pi/4 for a spheroid</span>

                <span class="c1"># Low-speed linear damping matrix parameters:</span>
                <span class="s2">"T_surge"</span><span class="p">:</span>      <span class="mi">20</span><span class="p">,</span>     <span class="c1"># Surge time constant (s)</span>
                <span class="s2">"T_sway"</span><span class="p">:</span>       <span class="mi">20</span><span class="p">,</span>     <span class="c1"># Sway time constant (s)</span>
                <span class="s2">"zeta_roll"</span><span class="p">:</span>    <span class="mf">0.3</span><span class="p">,</span>    <span class="c1"># Roll damping ratio</span>
                <span class="s2">"zeta_pitch"</span><span class="p">:</span>   <span class="mf">0.8</span><span class="p">,</span>    <span class="c1"># Pitch damping ratio</span>
                <span class="s2">"T_yaw"</span><span class="p">:</span>        <span class="mi">1</span><span class="p">,</span>      <span class="c1"># Yaw time constant (s)</span>
                <span class="s2">"K_nomoto"</span><span class="p">:</span>     <span class="mf">0.25</span><span class="p">,</span>   <span class="c1"># Nomoto gain</span>

                <span class="c1"># Other damping parameters:</span>
                <span class="s2">"r44"</span><span class="p">:</span>          <span class="mf">0.3</span><span class="p">,</span>    <span class="c1"># Added moment of inertia in roll: A44 = r44 * Ix</span>
                <span class="s2">"Cd"</span><span class="p">:</span>           <span class="mf">0.42</span><span class="p">,</span>   <span class="c1"># Coefficient of drag</span>
                <span class="s2">"e"</span><span class="p">:</span>            <span class="mf">0.7</span><span class="p">,</span>    <span class="c1"># Oswald efficiency factor for vehicle drag</span>
            <span class="p">},</span>
            <span class="s2">"actuator"</span><span class="p">:{</span>
                <span class="c1"># Fins:</span>
                <span class="s2">"fin_count"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>         <span class="c1"># Number of equally spaced fins on the vehicle</span>
                <span class="s2">"fin_offset_deg"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>    <span class="c1"># Angle offset of first fin around x axis (deg) starting from positive y with z down</span>
                                        <span class="c1"># 0 deg: fin on port side</span>
                                        <span class="c1"># 90 deg: fin on bottom</span>
                <span class="s2">"fin_center"</span><span class="p">:</span>   <span class="mf">0.1</span><span class="p">,</span>    <span class="c1"># radius (m) from COP on the fin to the COM in the YZ plane</span>
                <span class="s2">"fin_area"</span><span class="p">:</span>     <span class="mf">0.00697</span><span class="p">,</span> <span class="c1"># Surface area of one side of a fin</span>
                <span class="s2">"x_fin"</span><span class="p">:</span>       <span class="o">-</span><span class="mf">0.8</span><span class="p">,</span>    <span class="c1"># Body frame x distance (x forward) from center of mass to fin COP</span>
                <span class="s2">"CL_delta"</span><span class="p">:</span>     <span class="mf">0.5</span><span class="p">,</span>    <span class="c1"># Coefficient of lift for fin</span>
                <span class="s2">"deltaMax_fin_deg"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="c1"># Max deflection of the fin (degrees)</span>
                <span class="s2">"T_delta"</span><span class="p">:</span>      <span class="mf">0.1</span><span class="p">,</span>    <span class="c1"># Time constant for fin actuation. (s)</span>

                <span class="c1"># Propellor:</span>
                <span class="s2">"nMax"</span><span class="p">:</span>         <span class="mi">1525</span><span class="p">,</span>   <span class="c1"># Max rpm of the thruster</span>
                <span class="s2">"T_n"</span><span class="p">:</span>          <span class="mf">1.0</span><span class="p">,</span>    <span class="c1"># Time constant for thruster actuation. (s)</span>
                <span class="s2">"D_prop"</span><span class="p">:</span>       <span class="mf">0.14</span><span class="p">,</span>   <span class="c1"># Propeller diameter</span>
                <span class="s2">"t_prop"</span><span class="p">:</span>       <span class="mf">0.1</span><span class="p">,</span>    <span class="c1"># Propeller pitch</span>
                <span class="s2">"KT_0"</span><span class="p">:</span>         <span class="mf">0.4566</span><span class="p">,</span> <span class="c1"># Thrust coefficient at zero rpm</span>
                <span class="s2">"KQ_0"</span><span class="p">:</span>         <span class="mf">0.0700</span><span class="p">,</span> <span class="c1"># Torque coefficient at zero rpm</span>
                <span class="s2">"KT_max"</span><span class="p">:</span>       <span class="mf">0.1798</span><span class="p">,</span> <span class="c1"># Max thrust coefficient</span>
                <span class="s2">"KQ_max"</span><span class="p">:</span>       <span class="mf">0.0312</span><span class="p">,</span> <span class="c1"># Max torque coefficient</span>
                <span class="s2">"w"</span><span class="p">:</span>            <span class="mf">0.056</span><span class="p">,</span>  <span class="c1"># wake fraction number</span>
                <span class="s2">"Ja_max"</span><span class="p">:</span>       <span class="mf">0.6632</span><span class="p">,</span> <span class="c1"># Max advance ratio</span>
            <span class="p">},</span>
            <span class="s2">"autopilot"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'depth'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">'wn_d_z'</span><span class="p">:</span>   <span class="mf">0.12</span><span class="p">,</span>    <span class="c1"># Damped natural frequency for low pass filter for depth commands</span>
                    <span class="s1">'Kp_z'</span><span class="p">:</span>     <span class="mf">0.153</span><span class="p">,</span>    <span class="c1"># Proportional gain for depth controller</span>
                    <span class="s1">'T_z'</span><span class="p">:</span>      <span class="mi">100</span><span class="p">,</span>    <span class="c1"># Time constant for depth controller</span>
                    <span class="s1">'Kp_theta'</span><span class="p">:</span> <span class="mf">39.78</span><span class="p">,</span>    <span class="c1"># Proportional gain for pitch angle for depth controller</span>
                    <span class="s1">'Kd_theta'</span><span class="p">:</span> <span class="mf">17.1</span><span class="p">,</span>    <span class="c1"># Derivative gain for pitch angle for depth controller</span>
                    <span class="s1">'Ki_theta'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>    <span class="c1"># Integral gain for pitch angle for depth controller</span>
                    <span class="s1">'wn_d_theta'</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>    <span class="c1"># Damped natural frequency for low pass filter for depth commands</span>
                    <span class="s1">'K_w'</span><span class="p">:</span>      <span class="mf">0.0</span><span class="p">,</span>    <span class="c1"># Optional heave velocity feedback gain</span>
                    <span class="s1">'theta_max_deg'</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="c1"># Max output of pitch controller inner loop</span>
                    <span class="s1">'outer_loop_threshold'</span><span class="p">:</span> <span class="mf">2.91</span><span class="p">,</span> <span class="c1"># Threshold for outer loop to switch to surge control</span>
                    <span class="s1">'surge_threshold'</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="c1"># Surge threshold for running depth controller.</span>
                <span class="p">},</span>
                <span class="s1">'heading'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">'wn_d'</span><span class="p">:</span>     <span class="mf">0.4</span><span class="p">,</span>    <span class="c1"># Damped natural frequency of input commands for low pass filter</span>
                    <span class="s1">'zeta_d'</span><span class="p">:</span>   <span class="mf">1.0</span><span class="p">,</span>    <span class="c1"># Damping coefficient</span>
                    <span class="s1">'r_max'</span><span class="p">:</span>    <span class="mf">0.87</span><span class="p">,</span>
                    <span class="s1">'lam'</span><span class="p">:</span>      <span class="mf">0.1</span><span class="p">,</span>
                    <span class="s1">'phi_b'</span><span class="p">:</span>    <span class="mf">0.1</span><span class="p">,</span>
                    <span class="s1">'K_d'</span><span class="p">:</span>      <span class="mf">0.5</span><span class="p">,</span>
                    <span class="s1">'K_sigma'</span><span class="p">:</span>  <span class="mf">0.05</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="simulation-setup">
<h3>Simulation Setup<a class="headerlink" href="#simulation-setup" title="Permalink to this heading"></a></h3>
<p>The setup for the simulation is similar to other HoloOcean <a class="reference internal" href="../../examples/examples.html#examples"><span class="std std-ref">Examples</span></a>.</p>
<p>Simulation setup proceeds first by setting up an environment. We create a list of the names of agents in our
scenario that will be controlled by the Fossen dynamics. The list of
fossen agent names and scenario configuration are passed to the Fossen Interface.
Finally, we initialize a NumPy array of length 6 for linear accelerations (x, y, z)
and angular accelerations (about axis x, y, z), all in the global NWU frame.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">holoocean</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">holoocean.fossen_dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">scenario</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="c1"># See above for scenario configuration</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">holoocean</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">scenario_cfg</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>

<span class="c1"># Initialize Fossen dynamics model for the agent</span>
<span class="n">fossen_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'auv0'</span><span class="p">]</span> <span class="c1"># List of names of the agents that will use Fossen dynamics</span>
<span class="n">fossen_interface</span> <span class="o">=</span> <span class="n">FossenInterface</span><span class="p">(</span><span class="n">fossen_agents</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span>
<span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># Initialize HoloOcean acceleration input</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running the simulation live with the Unreal Editor in Standalone mode, be sure to
change the additional launch parameters as described in <a class="reference internal" href="../../develop/start.html#develop-start"><span class="std std-ref">Getting Started</span></a>. Add the launch
parameter <cite>-TicksPerSec</cite> to match what is in the Python script for consistent timing.</p>
</div>
</section>
<section id="manual-control-example">
<h3>Manual Control Example<a class="headerlink" href="#manual-control-example" title="Permalink to this heading"></a></h3>
<p>To use the manual control method, configure the vehicle mode with the fossen interface to “manualControl” mode.
The commanded fin angles can also be set using the Fossen interface.</p>
<p>The length of the <cite>u_control</cite> array is defined in the dynamic model class. It represents the number
of command inputs.</p>
<ul class="simple">
<li><p>Fin angles should be given in radians. The example below shows how to convert fin angles from
degrees to radians using numpy.</p></li>
<li><p>A positive fin deflection is represented by the right hand rule with a positive rotation about the Z axis.
The positive Z axis extends out of the vehicle from the center body frame x axis towards the COP of the fin.</p></li>
</ul>
<p>A custom controller can be used with this manual control method to input specific fin commands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="s1">'manualControl'</span><span class="p">)</span>
<span class="n">fins_degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># Fin deflections in degrees</span>
<span class="n">fin_radians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">fins_degrees</span><span class="p">)</span>
<span class="n">thruster_rpm</span> <span class="o">=</span> <span class="mi">800</span>  <span class="c1"># not a percent: check the vehicle dynamics for the max RPM</span>
<span class="n">u_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fin_radians</span><span class="p">,</span> <span class="n">thruster_rpm</span><span class="p">)</span>
</pre></div>
</div>
<p>To tick the environment, call the <cite>step</cite> function and pass it a list of accelerations. Next,
send control commands to the surfaces using the set_u_control function on the FossenInterface object.
It is not required to set the <cite>u_control</cite> every tick. If you want to change the control
surfaces every tick, set the control command before calling update.</p>
<p>The <cite>FossenInterface.update</cite> function takes in the state returned from HoloOcean and parses the data
from the Dynamics Sensor. Given the state of the vehicle and control surface inputs, it calculates
an output of accelerations in the HoloOcean frame (NWU).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1500</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">accel</span><span class="p">)</span>
    <span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_u_control</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="n">u_control</span><span class="p">)</span>  <span class="c1"># If desired, you can change the control command here</span>
    <span class="n">accel</span> <span class="o">=</span> <span class="n">fossen_interface</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>  <span class="c1"># Calculate accelerations to be applied to HoloOcean agent</span>
</pre></div>
</div>
</section>
<section id="depth-and-heading-control-example">
<h3>Depth and Heading Control Example<a class="headerlink" href="#depth-and-heading-control-example" title="Permalink to this heading"></a></h3>
<p>A common control strategy for underwater vehicles is to control depth and heading separately. This
can be done by setting the control mode to <cite>depthHeadingAutopilot</cite> and setting the goal depth,
heading, and thruster RPM.</p>
<p>The depth goal is defined in meters. A positive depth corresponds to a negative z location, with
depth increasing the further the vehicle descends.</p>
<p>The heading goal is given in the global frame. It ranges from -180 to 180 degrees, with 0 degrees
being north (along the positive x-axis) and 90 degrees being West (along the positive y axis).</p>
<p>The thruster goal is given directly as RPM, not as a percentage of the maximum RPM. Be sure to
check the max RPM in the Fossen vehicle configuration to ensure the command is below the maximum.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When switching to the autopilot control mode more than once there is a possibility of irregular behavior
from the autopilot not setting the LP initial position to the current position. This is a known issue
and will be fixed in a future release.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">depth_goal</span> <span class="o">=</span> <span class="mi">279</span> <span class="c1"># meters</span>
<span class="n">heading_goal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span> <span class="c1"># degrees</span>
<span class="n">thruster_goal</span> <span class="o">=</span> <span class="mi">1525</span> <span class="c1"># RPM</span>

<span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="s1">'depthHeadingAutopilot'</span><span class="p">)</span>
<span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_goal</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="n">depth_goal</span><span class="p">,</span> <span class="n">heading_goal</span><span class="p">,</span> <span class="n">thruster_goal</span><span class="p">)</span>

<span class="c1"># Run simulation</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1500</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">accel</span><span class="p">)</span>
    <span class="n">accel</span> <span class="o">=</span> <span class="n">fossen_interface</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">'auv0'</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="c1"># Optional arrow visualization (for direction of heading and depth goal)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">'DynamicsSensor'</span><span class="p">][</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>  <span class="c1"># [x, y, z]</span>
    <span class="n">x_end</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">heading_goal</span><span class="p">))</span>
    <span class="n">y_end</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">heading_goal</span><span class="p">))</span>

    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="k">else</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">draw_arrow</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="p">[</span><span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span><span class="p">,</span> <span class="o">-</span><span class="n">depth</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lifetime</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="multi-agent-fossen-dynamics-example">
<h2>Multi Agent Fossen Dynamics Example<a class="headerlink" href="#multi-agent-fossen-dynamics-example" title="Permalink to this heading"></a></h2>
<p>In this section we will step through using fossen dynamics with multiple
agents in HoloOcean. The full code can be found in <cite>client/example.py</cite>.
This example is very similar to the above example but with two agents.</p>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>See the above example for specific instructions for setting up the configuration for the following items:</p>
<ul class="simple">
<li><p>Dynamics Sensor</p></li>
<li><p>Fossen Model</p></li>
<li><dl class="simple">
<dt>Control Scheme</dt><dd><p>Note that the surface vessel agent using the control scheme 2 for custom dynamics.</p>
</dd>
</dl>
</li>
<li><p>Control Mode (optional)</p></li>
<li><dl class="simple">
<dt>Parameters (optional)</dt><dd><p>Note that the configuration from scenario of the otter class is not implemented yet so no parameters can be set.</p>
</dd>
</dl>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"name"</span><span class="p">:</span> <span class="s2">"multi_agent_fossen"</span><span class="p">,</span>
<span class="s2">"world"</span><span class="p">:</span> <span class="s2">"OpenWater"</span><span class="p">,</span>
<span class="s2">"package_name"</span><span class="p">:</span> <span class="s2">"Ocean"</span><span class="p">,</span>
<span class="s2">"main_agent"</span><span class="p">:</span> <span class="s2">"auv0"</span><span class="p">,</span>
<span class="s2">"agents"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"agent_name"</span><span class="p">:</span> <span class="s2">"auv0"</span><span class="p">,</span>
        <span class="s2">"agent_type"</span><span class="p">:</span> <span class="s2">"TorpedoAUV"</span><span class="p">,</span>
        <span class="s2">"sensors"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"sensor_type"</span><span class="p">:</span> <span class="s2">"DynamicsSensor"</span><span class="p">,</span>
                <span class="s2">"configuration"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"UseCOM"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">"UseRPY"</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># Use quaternion for dynamics</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">],</span>
        <span class="s2">"control_scheme"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Control scheme 1 is how custom dynamics are applied to TAUV</span>
        <span class="s2">"location"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">"rotation"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">"fossen_model"</span><span class="p">:</span> <span class="s2">"torpedo"</span><span class="p">,</span>
        <span class="s2">"control_mode"</span><span class="p">:</span> <span class="s2">"manualControl"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
        <span class="s2">"agent_name"</span><span class="p">:</span> <span class="s2">"sv1"</span><span class="p">,</span>
        <span class="s2">"agent_type"</span><span class="p">:</span> <span class="s2">"SurfaceVessel"</span><span class="p">,</span>
        <span class="s2">"sensors"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"sensor_type"</span><span class="p">:</span> <span class="s2">"DynamicsSensor"</span><span class="p">,</span>
                <span class="s2">"configuration"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"UseCOM"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">"UseRPY"</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># Use quaternion for dynamics</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">],</span>
        <span class="s2">"control_scheme"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Control scheme 2 is how custom dynamics are applied to SV</span>
        <span class="s2">"location"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">"rotation"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">"fossen_model"</span><span class="p">:</span> <span class="s2">"otter"</span><span class="p">,</span>
        <span class="s2">"control_mode"</span><span class="p">:</span> <span class="s2">"manualControl"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Simulation Setup<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>The setup is about the single agent example.</p>
<p>The only difference is that you need to add the name of the surface vessel agent to the fossen_agents list</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">holoocean</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">holoocean.fossen_dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">scenario</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="c1"># See above for scenario configuration</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">holoocean</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">scenario_cfg</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>
<span class="n">main_agent</span> <span class="o">=</span> <span class="s1">'auv0'</span>
<span class="n">sv_agent</span> <span class="o">=</span> <span class="s1">'sv1'</span>
<span class="n">fossen_agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_agent</span><span class="p">,</span> <span class="n">sv_agent</span><span class="p">]</span>
<span class="n">fossen_interface</span> <span class="o">=</span> <span class="n">FossenInterface</span><span class="p">(</span><span class="n">fossen_agents</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span>

<span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Manual Control Example<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>To use the manual control method, configure the vehicle mode with the fossen interface to “manualControl” mode.
The commanded fin angles can also be set using the Fossen interface.</p>
<p>The length of the <cite>u_control</cite> array is defined in the dynamic model class. It represents the number
of command inputs. The defualt torpedo has 5 control surfaces and the otter model has two thruster control surfaces.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ins_degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span> <span class="c1">#Rudder and Stern Fin Deflection (degrees)</span>
<span class="n">fin_radians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">fins_degrees</span><span class="p">)</span>
<span class="n">thruster_rpm</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">u_control_torpedo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fin_radians</span><span class="p">,</span><span class="n">thruster_rpm</span><span class="p">)</span>  <span class="c1">#[RudderAngle, SternAngle,Thruster] IN RADIANS</span>
<span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">main_agent</span><span class="p">,</span> <span class="s1">'manualControl'</span><span class="p">)</span>

<span class="n">u_control_otter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">105</span><span class="p">,</span> <span class="mi">80</span><span class="p">])</span>
<span class="n">fossen_interface</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">sv_agent</span><span class="p">,</span> <span class="s1">'manualControl'</span><span class="p">)</span>
</pre></div>
</div>
<p>The biggest difference with the multi-agent case is that to send commands to both agents the <code class="docutils literal notranslate"><span class="pre">act</span></code> and <code class="docutils literal notranslate"><span class="pre">tick</span></code> functions
are used instead of the <code class="docutils literal notranslate"><span class="pre">step</span></code> function. This difference is explained more in <a class="reference internal" href="../../usage/environments.html#step"><span class="std std-ref">Act, Tick, and Step</span></a>.</p>
<p>To set the control surface commands for the agent using the Fossen Interface the vehicle name is required.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FossenInterface.update</span></code> function takes in the states for both agents returned from the <code class="docutils literal notranslate"><span class="pre">tick</span></code> function and calculates
an output of accelerations. The update needs to be called for every agent in the list and then applied to the agent with the <code class="docutils literal notranslate"><span class="pre">act</span></code> function.</p>
</section>
</section>
</section>
</div>
</div>
<footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="control-schemes.html" rel="prev" title="Control Schemes"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
<a accesskey="n" class="btn btn-neutral float-right" href="../agents/hovering-auv-agent.html" rel="next" title="HoveringAUV">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<p>© Copyright BYU FRoStLab.</p>
</div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>