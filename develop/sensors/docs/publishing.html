<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/><meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Publishing Sensor Data — HoloOcean 1.0.0 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/themes_override.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/favicon.png" rel="shortcut icon"/>
<!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/js/theme.js"></script>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../sensors/singlebeam-sonar-sensor.html" rel="next" title="Single-Beam Sonar"/>
<link href="octree.html" rel="prev" title="Octree Generation"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../../index.html">
            HoloOcean
          </a>
<div class="version"><a href="../../../versionList.html" style="color: inherit;">Develop</a></div>
<div role="search">
<form action="../../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption" role="heading"><span class="caption-text">HoloOcean Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html">Using HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/packages.html">HoloOcean Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agents/agents.html">HoloOcean Agents</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../sensors.html">HoloOcean Sensors</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../sensors.html#using-sensors">Using Sensors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="sensor-config.html">Sensor Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="octree.html">Octree Generation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Publishing Sensor Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#publishing-data-using-lcm">Publishing Data Using LCM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publishing-data-using-ros2-bridge">Publishing Data Using ROS2 Bridge</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#id1">HoloOcean Sensors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versionList.html">Other Versions Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../develop/develop.html">Developing HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/index.html">HoloOcean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/spaces.html">Action Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/holooceanclient.html">HoloOcean Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/packagemanager.html">Package Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/lcm.html">LCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/dynamics.html">Fossen Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/shmem.html">Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/util.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../holoocean/weather.html">Weather Controller</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../../index.html">HoloOcean</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Home" class="icon icon-home" href="../../index.html"></a></li>
<li class="breadcrumb-item"><a href="../sensors.html">HoloOcean Sensors</a></li>
<li class="breadcrumb-item active">Publishing Sensor Data</li>
<li class="wy-breadcrumbs-aside">
<a href="../../_sources/sensors/docs/publishing.rst.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<section id="publishing-sensor-data">
<h1>Publishing Sensor Data<a class="headerlink" href="#publishing-sensor-data" title="Permalink to this heading"></a></h1>
<section id="publishing-data-using-lcm">
<span id="lcm"></span><h2>Publishing Data Using LCM<a class="headerlink" href="#publishing-data-using-lcm" title="Permalink to this heading"></a></h2>
<p>HoloOcean supports publishing data to LCM (Lightweight Communications and Marshalling), a messaging
system that is used to communicate between different processes. This allows you to publish sensor
data to LCM channels, which can be used to communicate with other systems.</p>
<p>LCM configuration happens in the <a class="reference internal" href="../../usage/scenarios.html#scenarios"><span class="std std-ref">scenario</span></a> file. LCM publishes data to a
medium called the provider. This can be local, over the network, a log file, etc. This can be
specified in the header of the scenario file. See <a class="reference external" href="https://lcm-proj.github.io/lcm/">here</a>
for options on this. If no provider is specified, HoloOcean uses the default LCM udqm.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">   </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{Scenario Name}"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"world"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{world it is associated with}"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"lcm_provider"</span><span class="p">:</span><span class="w"> </span><span class="nt">"file:///home/lcm.log"</span>
<span class="w">   </span><span class="nt">"agents"</span><span class="p">:[</span>
<span class="w">      </span><span class="s2">"array of agent objects"</span>
<span class="w">   </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the provider is chosen, HoloOcean publishes each sensor individually. The lcm_channel is
set in the sensor configuration. If no channel is specified, the sensor will not be published.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">   </span><span class="nt">"sensor_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RGBCamera"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"sensor_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FrontCamera"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"lcm_channel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAMERA"</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="publishing-data-using-ros2-bridge">
<span id="ros"></span><h2>Publishing Data Using ROS2 Bridge<a class="headerlink" href="#publishing-data-using-ros2-bridge" title="Permalink to this heading"></a></h2>
<p>ROS2 (Robot Operating System) is a popular middleware for robotics development. We have created
the ROS2 Bridge package to allow users to connect ROS2 with other middleware systems, such as LCM
and HoloOcean. This allows you to use ROS2 to control HoloOcean agents and publish sensor data to
ROS2 topics.</p>
<p>This feature is written specifically to work with the implementation of Fossen vehicle dynamics.</p>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h3>
<p>Using the ROS2 Bridge requires downloading a separate package. After installing HoloOcean, clone the
following repository into a ROS2 workspace: <a class="reference external" href="https://github.com/byu-holoocean/holoocean-ros">https://github.com/byu-holoocean/holoocean-ros</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>Currently, the ROS2 Bridge only supports <strong>single-agent scenarios</strong>.</p></li>
<li><p>Running holoocean and ROS2 in a virtual environment (ie. conda) may cause dependency issues.</p></li>
<li><p>The speed of the simulation may max out, which may cause timing errors.</p></li>
</ul>
</div>
<p>The ROS workspace for holoocean works with the Humble installation of ROS2. Follow the ROS2
installation tutorials: <a class="reference external" href="https://docs.ros.org/en/humble/Tutorials">https://docs.ros.org/en/humble/Tutorials</a></p>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h3>
<p>The example controller can be run after building the package in your ROS workspace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ros</span><span class="o">/</span><span class="n">humble</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
<span class="n">colcon</span> <span class="n">build</span>
<span class="n">source</span> <span class="n">install</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>

<span class="n">ros2</span> <span class="n">launch</span> <span class="n">holoocean_main</span> <span class="n">torpedo_launch</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Follow the ROS2 documentation to build nodes to control the holoocean environment.</p>
<p>The holoocean_main node:</p>
<ul class="simple">
<li><p>Subscribes to Controller commands</p></li>
<li><p>Publishes the sensor data retuned in holoocean state</p></li>
<li><p>Creates a timer to tick the environment</p></li>
</ul>
<p>The holoocean publishers will use the namespace “holoocean” (see ROS documentation on namespaces).
The name of the topic will follow the scenario name for the sensor. If there is no name given, it
will be the same as sensor type.</p>
<p>Holoocean Interface package:</p>
<ul class="simple">
<li><p>Holds the messages and service used for publishing sensor data</p></li>
</ul>
<p>command_example node:</p>
<ul class="simple">
<li><p>Publishes random HSD commands at specific intervals</p></li>
<li><p>Or publishes a preprogrammed sequence of HSD commands</p></li>
</ul>
</section>
<section id="publishing-your-own-sensor">
<h3>Publishing Your Own Sensor<a class="headerlink" href="#publishing-your-own-sensor" title="Permalink to this heading"></a></h3>
<p>The ROS2 Bridge can be configured to work with custom sensors. After implementing your sensor in
HoloOcean(see <a class="reference internal" href="../../develop/sensors.html#develop-sensor"><span class="std std-ref">Developing Sensors</span></a>), follow these steps to publish your sensor data:
- Make a <code class="docutils literal notranslate"><span class="pre">.msg</span></code> file in <code class="docutils literal notranslate"><span class="pre">holoocean_interfaces</span></code> (ex. <code class="docutils literal notranslate"><span class="pre">SensorData.msg</span></code>)
- Add <code class="docutils literal notranslate"><span class="pre">.msg</span></code> file to Cmake list (ex. <code class="docutils literal notranslate"><span class="pre">msg/SesnorData.msg</span></code>)
- In the sensor data converter file:</p>
<blockquote>
<div><ul class="simple">
<li><p>Add an elif statement in the <code class="docutils literal notranslate"><span class="pre">convert_to_msg</span></code> function</p></li>
<li><p>Add a Key to <code class="docutils literal notranslate"><span class="pre">sensor_keys</span></code></p></li>
<li><p>Import the message object in first line of the file (ex. <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">holoocean_interfaces.msg</span> <span class="pre">import</span> <span class="pre">SensorData</span></code>)</p></li>
<li><p>Add a function to encode the data into a ROS message</p></li>
</ul>
</div></blockquote>
<p>Run the following code to rebuild your ROS2 workspace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ros</span><span class="o">/</span><span class="n">humble</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
<span class="n">colcon</span> <span class="n">build</span>
<span class="n">source</span> <span class="n">install</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
</pre></div>
</div>
</section>
<section id="record-your-data">
<h3>Record Your Data<a class="headerlink" href="#record-your-data" title="Permalink to this heading"></a></h3>
<p>You can record the data from the HoloOcean environment using ros2bag. With ros2bag installed, you can
record sensor data or commands by running a command like this from your ros2_ws folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">install</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
<span class="n">ros2</span> <span class="n">bag</span> <span class="n">record</span> <span class="o">/</span><span class="n">holoocean</span><span class="o">/</span><span class="n">desiredHSD</span> <span class="o">/</span><span class="n">holoocean</span><span class="o">/</span><span class="n">RotationSensor</span> <span class="o">/</span><span class="n">holoocean</span><span class="o">/</span><span class="n">LocationSensor</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">save_data</span>
</pre></div>
</div>
<p>You can read more on the ros2 Documentation here to record and play back ros2 bag data:
<a class="reference external" href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data.html">https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data.html</a></p>
</section>
</section>
</section>
</div>
</div>
<footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="octree.html" rel="prev" title="Octree Generation"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
<a accesskey="n" class="btn btn-neutral float-right" href="../sensors/singlebeam-sonar-sensor.html" rel="next" title="Single-Beam Sonar">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<p>© Copyright BYU FRoStLab.</p>
</div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>